<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>底层命令 | zxx&#39;s blog</title>
    <meta name="description" content="Just playing around">
    
    
    <link rel="preload" href="/blog.my/assets/css/0.styles.1f7f0793.css" as="style"><link rel="preload" href="/blog.my/assets/js/app.df2e6283.js" as="script"><link rel="preload" href="/blog.my/assets/js/2.d648bd6d.js" as="script"><link rel="preload" href="/blog.my/assets/js/8.bd7d7b77.js" as="script"><link rel="prefetch" href="/blog.my/assets/js/10.54e7a781.js"><link rel="prefetch" href="/blog.my/assets/js/3.52812c49.js"><link rel="prefetch" href="/blog.my/assets/js/4.d6e64f60.js"><link rel="prefetch" href="/blog.my/assets/js/5.004dc1d1.js"><link rel="prefetch" href="/blog.my/assets/js/6.5e4fd1ca.js"><link rel="prefetch" href="/blog.my/assets/js/7.6f7bca89.js"><link rel="prefetch" href="/blog.my/assets/js/9.07c6102d.js">
    <link rel="stylesheet" href="/blog.my/assets/css/0.styles.1f7f0793.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/blog.my/" class="home-link router-link-active"><!----> <span class="site-name">zxx's blog</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/blog.my/" class="nav-link">Home</a></div><div class="nav-item"><a href="/blog.my/guide/" class="nav-link">Guide</a></div><div class="nav-item"><a href="https://google.com" target="_blank" rel="noopener noreferrer" class="nav-link external">
  External
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">Languages</span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/blog.my/language/chinese.html" class="nav-link">简体中文</a></li><li class="dropdown-item"><!----> <a href="/blog.my/language/japanese.html" class="nav-link">Japanese</a></li></ul></div></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/blog.my/" class="nav-link">Home</a></div><div class="nav-item"><a href="/blog.my/guide/" class="nav-link">Guide</a></div><div class="nav-item"><a href="https://google.com" target="_blank" rel="noopener noreferrer" class="nav-link external">
  External
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">Languages</span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/blog.my/language/chinese.html" class="nav-link">简体中文</a></li><li class="dropdown-item"><!----> <a href="/blog.my/language/japanese.html" class="nav-link">Japanese</a></li></ul></div></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>JS</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/blog.my/JS/module.html" class="sidebar-link">ES6 module | 模块化</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span>GIT</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/blog.my/git/git-base.html" class="sidebar-link">基础</a></li><li><a href="/blog.my/git/git-internals.html" class="active sidebar-link">底层命令</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/blog.my/git/git-internals.html#git目录" class="sidebar-link">.git目录</a></li><li class="sidebar-sub-header"><a href="/blog.my/git/git-internals.html#git-object-对象" class="sidebar-link">Git object 对象</a></li><li class="sidebar-sub-header"><a href="/blog.my/git/git-internals.html#树对象" class="sidebar-link">树对象</a></li><li class="sidebar-sub-header"><a href="/blog.my/git/git-internals.html#提交对象" class="sidebar-link">提交对象</a></li><li class="sidebar-sub-header"><a href="/blog.my/git/git-internals.html#模拟对象存储" class="sidebar-link">模拟对象存储</a></li></ul></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>SHELL</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/blog.my/shell/subshell.html" class="sidebar-link">子 shell</a></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="底层命令"><a href="#底层命令" aria-hidden="true" class="header-anchor">#</a> 底层命令</h1> <h2 id="git目录"><a href="#git目录" aria-hidden="true" class="header-anchor">#</a> .git目录</h2> <p>当在一个新目录或已有目录执行 git init 时，Git 会创建一个 .git 目录。 这个目录包含了几乎所有 Git 存储和操作的对象。 如若想备份或复制一个版本库，只需把这个目录拷贝至另一处即可。</p> <div class="language-sh line-numbers-mode"><pre class="language-sh"><code><span class="token function">git</span> init <span class="token builtin class-name">test</span>
<span class="token function">ls</span> test/.git
Initialized empty Git repository <span class="token keyword">in</span> /Users/zhengxingxing/Desktop/git.my/git-demo/test/.git/
HEAD        config      hooks       objects
branches    description info        refs
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p><strong>目录结构</strong></p> <ul><li>description 文件仅供 GitWeb 程序使用，我们无需关心。</li> <li>config 文件包含项目特有的配置选项。</li> <li>info 目录包含一个全局性排除（global exclude）文件，用以放置那些不希望被记录在 .gitignore 文件中的忽略模式（ignored patterns）。</li> <li>hooks 目录包含客户端或服务端的钩子脚本（hook scripts），在 Git 钩子 中这部分话题已被详细探讨过。</li></ul> <p><strong>核心目录</strong></p> <ul><li>objects 目录存储所有数据内容；</li> <li>refs 目录存储指向数据（分支）的提交对象的指针；</li> <li>HEAD 文件指示目前被检出的分支；</li> <li>index 文件保存暂存区信息。</li></ul> <h2 id="git-object-对象"><a href="#git-object-对象" aria-hidden="true" class="header-anchor">#</a> Git object 对象</h2> <ul><li>mingl
git hash-object -w
git cat-file -p
初始化项目</li></ul> <div class="language-sh line-numbers-mode"><pre class="language-sh"><code>$ <span class="token function">git</span> init <span class="token builtin class-name">test</span>
Initialized empty Git repository <span class="token keyword">in</span> /tmp/test/.git/
$ <span class="token builtin class-name">cd</span> <span class="token builtin class-name">test</span>
$ <span class="token function">find</span> .git/objects
.git/objects
.git/objects/info
.git/objects/pack
$ <span class="token function">find</span> .git/objects -type f
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><p>可以看到 <code>.git/bojects</code> 目录没有文件,接下来写入内容</p> <div class="language-sh line-numbers-mode"><pre class="language-sh"><code>$ <span class="token builtin class-name">echo</span> <span class="token string">'test content'</span> <span class="token operator">|</span> <span class="token function">git</span> hash-object -w --stdin
d670460b4b4aece5915caf5c68d12f560a9fe3e4
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>-w 选项指示 hash-object 命令写入(存储)数据对象；若不指定此选项，则该命令查看(返回)对应的键值。</p> <p>--stdin 选项则指示该命令从标准输入读取内容；若不指定此选项，则须在命令尾部给出待存储文件的路径。</p> <p><strong>查看刚刚写入的内容</strong></p> <div class="language-sh line-numbers-mode"><pre class="language-sh"><code>$ <span class="token function">find</span> .git/objects -type f
.git/objects/d6/70460b4b4aece5915caf5c68d12f560a9fe3e4
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>取回刚刚存入的数据</p> <div class="language-sh line-numbers-mode"><pre class="language-sh"><code>$ <span class="token function">git</span> cat-file -p d670460b4b4aece5915caf5c68d12f560a9fe3e4
<span class="token builtin class-name">test</span> content
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>-p 选项可指示该命令自动判断内容的类型，并为我们显示格式友好的内容</p> <p>对文件进行简单的版本控制</p> <div class="language-sh line-numbers-mode"><pre class="language-sh"><code><span class="token comment"># 版本 1</span>
$ <span class="token builtin class-name">echo</span> <span class="token string">'version 1'</span> <span class="token operator">&gt;</span> test.txt
$ <span class="token function">git</span> hash-object -w test.txt
83baae61804e65cc73a7201a7252750c76066a30

<span class="token comment"># 版本 2</span>
$ <span class="token builtin class-name">echo</span> <span class="token string">'version 2'</span> <span class="token operator">&gt;</span> test.txt
$ <span class="token function">git</span> hash-object -w test.txt
1f7a7a472abf3dd9643fd615f6da379c4acb3e3a
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><p>查看当前数据对象</p> <div class="language-sh line-numbers-mode"><pre class="language-sh"><code>$ <span class="token function">find</span> .git/objects -type f
.git/objects/1f/7a7a472abf3dd9643fd615f6da379c4acb3e3a
.git/objects/83/baae61804e65cc73a7201a7252750c76066a30
.git/objects/d6/70460b4b4aece5915caf5c68d12f560a9fe3e4
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p>恢复版本</p> <div class="language-sh line-numbers-mode"><pre class="language-sh"><code><span class="token comment"># 版本 1</span>
$ <span class="token function">git</span> cat-file -p 83baae61804e65cc73a7201a7252750c76066a30 <span class="token operator">&gt;</span> test.txt
$ <span class="token function">cat</span> test.txt
version <span class="token number">1</span>

<span class="token comment"># 版本 2</span>
$ <span class="token function">git</span> cat-file -p 1f7a7a472abf3dd9643fd615f6da379c4acb3e3a <span class="token operator">&gt;</span> test.txt
$ <span class="token function">cat</span> test.txt
version <span class="token number">2</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><p>查看对象类型</p> <div class="language-sh line-numbers-mode"><pre class="language-sh"><code>$ <span class="token function">git</span> cat-file -t 1f7a7a472abf3dd9643fd615f6da379c4acb3e3a
blob
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><h2 id="树对象"><a href="#树对象" aria-hidden="true" class="header-anchor">#</a> 树对象</h2> <p>Git 根据 staging area 或 index 的状态创建一个对应的树对象.</p> <p>将 test.txt 的首个版本添加到暂存区(通过 sha1)</p> <div class="language-sh line-numbers-mode"><pre class="language-sh"><code>$ <span class="token function">git</span> update-index --add --cacheinfo <span class="token number">100644</span> <span class="token punctuation">\</span>
  83baae61804e65cc73a7201a7252750c76066a30 test.txt
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>必须的参数</p> <ul><li>--add 选项，因为此前该文件并不在暂存区中；</li> <li>--cacheinfo 选项，因为将要添加的文件位于 Git 数据库中，而不是位于当前目录下。</li> <li>文件模式</li> <li>SHA-1</li> <li>文件名</li></ul> <p>文件模式类型
<code>100644 普通文件 100755 可执行文件 120000 符号链接</code></p> <p>将暂存区内容写入一个树对象</p> <div class="language-sh line-numbers-mode"><pre class="language-sh"><code>$ <span class="token function">git</span> write-tree
d8329fc1cc938780ffdd9f94e0d364e0ea74f579

<span class="token comment"># 验证一下 确实是一个树对象</span>
$ <span class="token function">git</span> cat-file -p d8329fc1cc938780ffdd9f94e0d364e0ea74f579
<span class="token number">100644</span> blob
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><p>创建一个新的树对象</p> <div class="language-sh line-numbers-mode"><pre class="language-sh"><code>$ <span class="token builtin class-name">echo</span> <span class="token string">'new file'</span> <span class="token operator">&gt;</span> new.txt
$ <span class="token function">git</span> update-index --cacheinfo <span class="token number">100644</span> <span class="token punctuation">\</span>
  1f7a7a472abf3dd9643fd615f6da379c4acb3e3a test.txt
$ <span class="token function">git</span> update-index --add new.txt
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p>暂存区现在包含了 test.txt 文件的新版本，和一个新文件：new.txt。</p> <div class="language-sh line-numbers-mode"><pre class="language-sh"><code>$ <span class="token function">git</span> write-tree
0155eb4229851634a0f03eb265b69f5a2d56f341
$ <span class="token function">git</span> cat-file -p 0155eb4229851634a0f03eb265b69f5a2d56f341
<span class="token number">100644</span> blob fa49b077972391ad58037050f2a75f74e3671e92      new.txt
<span class="token number">100644</span> blob 1f7a7a472abf3dd9643fd615f6da379c4acb3e3a      test.txt
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p>我们注意到，新的树对象包含两条文件记录，同时 test.txt 的 SHA-1 值（1f7a7a）是先前值的“第二版”。</p> <p>只是为了好玩：你可以将第一个树对象加入第二个树对象，使其成为新的树对象的一个子目录。 通过调用 read-tree 命令，可以把树对象读入暂存区。 本例中，可以通过对 read-tree 指定 --prefix 选项，将一个已有的树对象作为子树读入暂存区：</p> <div class="language-sh line-numbers-mode"><pre class="language-sh"><code>$ <span class="token function">git</span> read-tree --prefix<span class="token operator">=</span>bak d8329fc1cc938780ffdd9f94e0d364e0ea74f579
$ <span class="token function">git</span> write-tree
3c4e9cd789d88d8d89c1073707c3585e41b0e614
$ <span class="token function">git</span> cat-file -p 3c4e9cd789d88d8d89c1073707c3585e41b0e614
040000 tree d8329fc1cc938780ffdd9f94e0d364e0ea74f579      bak
<span class="token number">100644</span> blob fa49b077972391ad58037050f2a75f74e3671e92      new.txt
<span class="token number">100644</span> blob 1f7a7a472abf3dd9643fd615f6da379c4acb3e3a      test.txt
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><h2 id="提交对象"><a href="#提交对象" aria-hidden="true" class="header-anchor">#</a> 提交对象</h2> <p>创建提交对象</p> <div class="language-sh line-numbers-mode"><pre class="language-sh"><code>$ <span class="token builtin class-name">echo</span> <span class="token string">'first commit'</span> <span class="token operator">|</span> <span class="token function">git</span> commit-tree d8329f
e298445ec83829563752781d8ec12df03d0c4b8d

<span class="token function">git</span> cat-file -p e298445e
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p>提交对象的格式很简单：它先指定一个顶层树对象，代表当前项目快照；然后是作者/提交者信息（依据你的 user.name 和 user.email 配置来设定，外加一个时间戳）；留空一行，最后是提交注释。</p> <div class="language-sh line-numbers-mode"><pre class="language-sh"><code>
$ <span class="token builtin class-name">echo</span> <span class="token string">'second commit'</span> <span class="token operator">|</span> <span class="token function">git</span> commit-tree 0155eb -p e298445e
2b6c7bd8182b3c64567fed676db10f6355b43485
$ <span class="token builtin class-name">echo</span> <span class="token string">'third commit'</span>  <span class="token operator">|</span> <span class="token function">git</span> commit-tree 3c4e9c -p 2b6c7bd8
fb35fdf07c35cfe7e65f5f8d645a3382edf8f29a
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><div class="language-sh line-numbers-mode"><pre class="language-sh"><code>commit fb35fdf07c35cfe7e65f5f8d645a3382edf8f29a
Author: <span class="token number">971389117</span> <span class="token operator">&lt;</span><span class="token number">971389117</span>@qq.com<span class="token operator">&gt;</span>
Date:   Mon Aug <span class="token number">12</span> <span class="token number">16</span>:36:57 <span class="token number">2019</span> +0800

    third commit

 bak/test.txt <span class="token operator">|</span> <span class="token number">1</span> +
 <span class="token number">1</span> <span class="token function">file</span> changed, <span class="token number">1</span> insertion<span class="token punctuation">(</span>+<span class="token punctuation">)</span>

commit 2b6c7bd8182b3c64567fed676db10f6355b43485
Author: <span class="token number">971389117</span> <span class="token operator">&lt;</span><span class="token number">971389117</span>@qq.com<span class="token operator">&gt;</span>
Date:   Mon Aug <span class="token number">12</span> <span class="token number">16</span>:36:37 <span class="token number">2019</span> +0800

    second commit

 new.txt  <span class="token operator">|</span> <span class="token number">1</span> +
 test.txt <span class="token operator">|</span> <span class="token number">2</span> +-
 <span class="token number">2</span> files changed, <span class="token number">2</span> insertions<span class="token punctuation">(</span>+<span class="token punctuation">)</span>, <span class="token number">1</span> deletion<span class="token punctuation">(</span>-<span class="token punctuation">)</span>

commit e298445ec83829563752781d8ec12df03d0c4b8d
Author: <span class="token number">971389117</span> <span class="token operator">&lt;</span><span class="token number">971389117</span>@qq.com<span class="token operator">&gt;</span>
Date:   Mon Aug <span class="token number">12</span> <span class="token number">16</span>:31:56 <span class="token number">2019</span> +0800

    first commit

 test.txt <span class="token operator">|</span> <span class="token number">1</span> +
 <span class="token number">1</span> <span class="token function">file</span> changed, <span class="token number">1</span> insertion<span class="token punctuation">(</span>+<span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br></div></div><p>太神奇了： 就在刚才，你没有借助任何上层命令，仅凭几个底层操作便完成了一个 Git 提交历史的创建。 这就是每次我们运行 git add 和 git commit 命令时， Git 所做的实质工作——将被改写的文件保存为数据对象，更新暂存区，记录树对象，最后创建一个指明了顶层树对象和父提交的提交对象。 这三种主要的 Git 对象——数据对象、树对象、提交对象——最初均以单独文件的形式保存在 .git/objects 目录下。 下面列出了目前示例目录内的所有对象，辅以各自所保存内容的注释：</p> <div class="language-sh line-numbers-mode"><pre class="language-sh"><code>$ <span class="token function">find</span> .git/objects -type f
.git/objects/01/55eb4229851634a0f03eb265b69f5a2d56f341 <span class="token comment"># tree 2</span>
.git/objects/1a/410efbd13591db07496601ebc7a059dd55cfe9 <span class="token comment"># commit 3</span>
.git/objects/1f/7a7a472abf3dd9643fd615f6da379c4acb3e3a <span class="token comment"># test.txt v2</span>
.git/objects/3c/4e9cd789d88d8d89c1073707c3585e41b0e614 <span class="token comment"># tree 3</span>
.git/objects/83/baae61804e65cc73a7201a7252750c76066a30 <span class="token comment"># test.txt v1</span>
.git/objects/ca/c0cab538b970a37ea1e769cbbde608743bc96d <span class="token comment"># commit 2</span>
.git/objects/d6/70460b4b4aece5915caf5c68d12f560a9fe3e4 <span class="token comment"># 'test content'</span>
.git/objects/d8/329fc1cc938780ffdd9f94e0d364e0ea74f579 <span class="token comment"># tree 1</span>
.git/objects/fa/49b077972391ad58037050f2a75f74e3671e92 <span class="token comment"># new.txt</span>
.git/objects/fd/f4fc3344e67ab068f836878b6c4951e3b15f3d <span class="token comment"># commit 1</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div><h2 id="模拟对象存储"><a href="#模拟对象存储" aria-hidden="true" class="header-anchor">#</a> 模拟对象存储</h2> <p>所有的 Git 对象均以下面这种方式存储，区别仅在于类型标识——另两种对象类型的头部信息以字符串“commit”或“tree”开头，而不是“blob”。 另外，虽然数据对象的内容几乎可以是任何东西，但提交对象和树对象的内容却有各自固定的格式。</p> <div class="language-ruby line-numbers-mode"><pre class="language-ruby"><code>content <span class="token operator">=</span> <span class="token string">&quot;what is up, doc?&quot;</span>
<span class="token comment"># Git 以对象类型作为开头来构造一个头部信息，本例中是一个“blob”字符串。 接着 Git 会添加一个空格，随后是数据内容的长度，最后是一个空字节（null byte）：</span>
header <span class="token operator">=</span> <span class="token string">&quot;blob <span class="token interpolation"><span class="token delimiter tag">#{</span>content<span class="token punctuation">.</span>length<span class="token delimiter tag">}</span></span>\0&quot;</span>
store <span class="token operator">=</span> header <span class="token operator">+</span> content

<span class="token keyword">require</span> <span class="token string">'digest/sha1'</span>
<span class="token comment"># SHA1 校验</span>
sha1 <span class="token operator">=</span> <span class="token constant">Digest</span><span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token constant">SHA1</span><span class="token punctuation">.</span>hexdigest<span class="token punctuation">(</span>store<span class="token punctuation">)</span>
<span class="token comment"># =&gt;&quot;bd9dbf5aae1a3862dd1526723246b20206e5fc37&quot;</span>

<span class="token keyword">require</span> <span class="token string">'zlib'</span>
zlib_content <span class="token operator">=</span> <span class="token constant">Zlib</span><span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token constant">Deflate</span><span class="token punctuation">.</span>deflate<span class="token punctuation">(</span>store<span class="token punctuation">)</span>

path <span class="token operator">=</span> <span class="token string">'.git/objects/'</span> <span class="token operator">+</span> sha1<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">]</span> <span class="token operator">+</span> <span class="token string">'/'</span> <span class="token operator">+</span> sha1<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">38</span><span class="token punctuation">]</span>
<span class="token keyword">require</span> <span class="token string">'fileutils'</span>
<span class="token constant">FileUtils</span><span class="token punctuation">.</span>mkdir_p<span class="token punctuation">(</span><span class="token builtin">File</span><span class="token punctuation">.</span>dirname<span class="token punctuation">(</span>path<span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token builtin">File</span><span class="token punctuation">.</span>open<span class="token punctuation">(</span>path<span class="token punctuation">,</span> <span class="token string">'w'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token operator">|</span>f<span class="token operator">|</span> f<span class="token punctuation">.</span>write zlib_content <span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br></div></div></div> <footer class="page-edit"><!----> <div class="last-updated"><span class="prefix">Last Updated: </span> <span class="time">8/16/2019, 10:57:36 AM</span></div></footer> <div class="page-nav"><p class="inner"><span class="prev">
        ←
        <a href="/blog.my/git/git-base.html" class="prev">
          基础
        </a></span> <span class="next"><a href="/blog.my/shell/subshell.html">
          子 shell
        </a>
        →
      </span></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/blog.my/assets/js/app.df2e6283.js" defer></script><script src="/blog.my/assets/js/2.d648bd6d.js" defer></script><script src="/blog.my/assets/js/8.bd7d7b77.js" defer></script>
  </body>
</html>
